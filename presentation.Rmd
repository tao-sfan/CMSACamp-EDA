---
title: "Give it a title"
author: 
  - "Sara Armstrong"
  - "Grace Fain"
  - "Sifan Tao"
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width=9, fig.height=3.5, fig.retina=3,
  out.width = "100%",
  cache = FALSE,
  echo = TRUE,
  message = FALSE, 
  warning = FALSE,
  fig.show = TRUE,
  hiline = TRUE
)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#1381B0",
  secondary_color = "#FF961C",
  inverse_header_color = "#FFFFFF"
)
```

## Motivation
-given data set 
- looking for relationships within the data
-practicing eda
---
## Dataset

- WTA Match Data: all WTA matches between 2018 and 2021
 - courtesy of Jeff Sackmannâ€™s famous tennis repository

-each observation was a player and from there was broken down into observations of winners and losers, for example the number of aces by each player was broken down into winner_ace and loser_ace

-most common used variables
 - w_ace, l_ace, surface
 
---
## Hypothesis
 1) The surface type with the most aces is the hard courts.
 
 2) The final matches would be the longest matches
 
 3) Players will have a high win rate on only one of the surfaces
 
---

```{r load-wta, echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)
wta_2018_2021_matches <-
  map_dfr(c(2018:2021),
          function(year) {
            read_csv(paste0("https://raw.githubusercontent.com/JeffSackmann/tennis_wta/master/wta_matches_",
                            year, ".csv")) %>%
              mutate(winner_seed = as.character(winner_seed),
                     loser_seed = as.character(loser_seed))
          })
```
---

## Aces are most common on grass surface courts
```{r surfacetype_ace, echo=FALSE}
wta_2018_2021_matches %>%
  mutate(total_ace = w_ace + l_ace) %>%
  filter(total_ace < 50) %>%
  ggplot(aes(y = total_ace, fill = surface)) +
  geom_boxplot(aes(x= '')) +
  coord_flip() +
  theme_bw()
```
---

## Final and semi final matches are typically longer
```{r match_length, echo = FALSE}
wta_2018_2021_matches %>%
  filter(minutes < 500) %>%
  ggplot(aes(x = minutes)) +
  geom_density() +
  facet_wrap(~ round) +
  geom_rug(alpha = .3) +
  theme_bw()
```

---
## Most players excel on a single surface type
```{r win_rate, echo = FALSE}
games_win = wta_2018_2021_matches%>% 
  group_by(winner_name, surface) %>%
  count() %>%
  rename(player = winner_name)

games_lose = wta_2018_2021_matches %>%
  group_by(loser_name, surface) %>%
  count() %>%
  rename(player = loser_name)

full_join(games_lose, games_win, by=c('player', 'surface')) %>%
  rename(wins = "n.y", losses = "n.x") %>% 
  replace_na(list(losses = 0, wins=0)) %>%
  mutate(total = wins+losses, winrate = wins/total) %>%
  arrange(surface, desc(winrate)) %>%
  filter(total >= 10) %>% 
  ungroup() %>%
  group_by(surface) %>%
  slice(1:10) %>%
  ggplot(aes(x=player, y=winrate)) +
  geom_bar(stat='identity') + 
  facet_wrap(~surface, ncol=1) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 3))
```

---
## Clustering
```{r clustering, echo = FALSE}
w_df_ace <-
  wta_2018_2021_matches %>%
  group_by(winner_name) %>%
  summarise(total_ace_w = sum(w_ace, na.rm = TRUE),
            total_df_w = sum(w_df, na.rm = TRUE),
            n_game_w = n()) %>%
  rename(name = winner_name)

l_df_ace <-
  wta_2018_2021_matches %>%
  group_by(loser_name) %>%
  summarise(total_ace_l = sum(l_ace, na.rm = TRUE),
            total_df_l = sum(l_df, na.rm = TRUE),
            n_game_l = n()) %>%
  rename(name = loser_name)

all_df_ace <- full_join(w_df_ace, l_df_ace, by = 'name') %>%
  replace_na(list(total_ace_w = 0, total_df_w = 0, n_game_w = 0, 
                  total_ace_l = 0, total_df_l = 0, n_game_l = 0)) %>%
  mutate(avg_ace = (total_ace_w + total_ace_l)/(n_game_w + n_game_l),
         avg_df = (total_df_w +total_df_l)/(n_game_w + n_game_l)) %>%
  filter(n_game_w +n_game_l > 10)


player_dist <- 
  dist(dplyr::select(all_df_ace, avg_ace, avg_df))

wta_hclust<-
  hclust(player_dist, method = "complete")

all_df_ace %>%
  mutate(player_clusters =
           as.factor(cutree(wta_hclust, k = 3))) %>%
  ggplot(aes(x = avg_ace, y = avg_df,
             color = player_clusters)) +
  geom_point() +
  theme_bw() +
  theme(legend.position = "bottom")
```

---
## Recap and what is next for the WTA match data


Aces are most common on grass courts.



Later round matches are typically longer than earlier rounds.



Players preform better on some surfaces than others

--

Through clustering, we can visualize groups of players that are more conservative with their serves versus players that are more aggressive.


-_Limitations:_
 - Due to the dataset separating winner and loser data, it made it difficult to explore and compare overall player performances

-_Next Steps:_ 
 - examining other player data such as second serve points and break points
 - manipulating the data to be able to compare players more easily


